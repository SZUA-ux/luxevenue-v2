exports.id=6960,exports.ids=[6960],exports.modules={99452:(e,t,r)=>{let n={"237c193e8d7301608cc32d64f4cf2cf85a3e4c2a":()=>Promise.resolve().then(r.bind(r,41168)).then(e=>e.convertLeadToBooking),"5a5df8cbec3f078b35ff84be13abb5cda79f9184":()=>Promise.resolve().then(r.bind(r,41168)).then(e=>e.sendBookingConfirmation),"7d201b312e9aa4dfb9228473a067d899b0e61886":()=>Promise.resolve().then(r.bind(r,41168)).then(e=>e.deleteBooking),abf23e5f822cda97e111448432b6ad102f96474c:()=>Promise.resolve().then(r.bind(r,41168)).then(e=>e.updateBookingStatus),c4610c7d06ced3d0209d5cf7f5974e06a28a4d2d:()=>Promise.resolve().then(r.bind(r,41168)).then(e=>e.generateBookingPDF),e572bdf7c1d800e1f33185e76fd9c48c06806f07:()=>Promise.resolve().then(r.bind(r,41168)).then(e=>e.updateBooking)};async function a(e,...t){return(await n[e]()).apply(null,t)}e.exports={"237c193e8d7301608cc32d64f4cf2cf85a3e4c2a":a.bind(null,"237c193e8d7301608cc32d64f4cf2cf85a3e4c2a"),"5a5df8cbec3f078b35ff84be13abb5cda79f9184":a.bind(null,"5a5df8cbec3f078b35ff84be13abb5cda79f9184"),"7d201b312e9aa4dfb9228473a067d899b0e61886":a.bind(null,"7d201b312e9aa4dfb9228473a067d899b0e61886"),abf23e5f822cda97e111448432b6ad102f96474c:a.bind(null,"abf23e5f822cda97e111448432b6ad102f96474c"),c4610c7d06ced3d0209d5cf7f5974e06a28a4d2d:a.bind(null,"c4610c7d06ced3d0209d5cf7f5974e06a28a4d2d"),e572bdf7c1d800e1f33185e76fd9c48c06806f07:a.bind(null,"e572bdf7c1d800e1f33185e76fd9c48c06806f07")}},65143:()=>{},74372:(e,t,r)=>{Promise.resolve().then(r.t.bind(r,12994,23)),Promise.resolve().then(r.t.bind(r,96114,23)),Promise.resolve().then(r.t.bind(r,9727,23)),Promise.resolve().then(r.t.bind(r,79671,23)),Promise.resolve().then(r.t.bind(r,41868,23)),Promise.resolve().then(r.t.bind(r,84759,23))},9494:(e,t,r)=>{"use strict";r.d(t,{default:()=>h});var n=r(10326),a=r(90434),i=r(35047),s=r(24319),o=r(24061),d=r(44856),c=r(85529),l=r(26754),u=r(5932),p=r(94019),m=r(90748),g=r(71810),f=r(17577);function h({children:e,user:t}){let r=(0,i.usePathname)(),h=(0,i.useRouter)(),[y,b]=(0,f.useState)(!1),[x,v]=(0,f.useState)(!1),w=async()=>{if(!x){v(!0);try{await fetch("/api/auth/logout",{method:"POST"}),h.push("/crm/login"),h.refresh()}catch(e){console.error("Logout error:",e),v(!1)}}},S=[{name:"Dashboard",href:"/crm",icon:s.Z},{name:"Leads",href:"/crm/leads",icon:o.Z},{name:"Bookings",href:"/crm/bookings",icon:d.Z},{name:"Clients",href:"/crm/clients",icon:c.Z},{name:"Analytics",href:"/crm/analytics",icon:l.Z},{name:"Email Log",href:"/crm/email-log",icon:u.Z}];return(0,n.jsxs)("div",{className:"min-h-screen bg-gradient-to-br from-slate-900 via-blue-900 to-slate-900",children:[(0,n.jsxs)("div",{className:"fixed inset-0 overflow-hidden pointer-events-none",children:[n.jsx("div",{className:"absolute top-0 left-0 w-96 h-96 bg-purple-500/20 rounded-full blur-3xl animate-pulse"}),n.jsx("div",{className:"absolute bottom-0 right-0 w-96 h-96 bg-blue-500/20 rounded-full blur-3xl animate-pulse",style:{animationDelay:"1s"}}),n.jsx("div",{className:"absolute top-1/2 left-1/2 w-96 h-96 bg-pink-500/20 rounded-full blur-3xl animate-pulse",style:{animationDelay:"2s"}})]}),n.jsx("header",{className:"fixed top-0 left-0 right-0 h-20 z-40 backdrop-blur-xl bg-slate-900/40 border-b border-white/10 shadow-2xl",children:(0,n.jsxs)("div",{className:"h-full px-6 flex items-center justify-between",children:[(0,n.jsxs)("div",{className:"flex items-center gap-4",children:[n.jsx("button",{onClick:()=>b(!y),className:"lg:hidden p-3 hover:bg-white/10 rounded-xl transition-all backdrop-blur-sm",children:y?n.jsx(p.Z,{className:"w-6 h-6 text-white"}):n.jsx(m.Z,{className:"w-6 h-6 text-white"})}),n.jsx("h1",{className:"text-3xl font-black bg-gradient-to-r from-purple-400 via-pink-400 to-blue-400 bg-clip-text text-transparent tracking-tight",children:"LUXE VENUE CRM"})]}),(0,n.jsxs)("div",{className:"flex items-center gap-4",children:[(0,n.jsxs)("div",{className:"hidden sm:flex items-center gap-3 px-6 py-3 bg-white/5 backdrop-blur-xl rounded-2xl border border-white/10 shadow-lg",children:[n.jsx("div",{className:"w-10 h-10 rounded-full bg-gradient-to-br from-purple-500 to-pink-500 flex items-center justify-center shadow-lg",children:n.jsx(c.Z,{className:"w-6 h-6 text-white"})}),n.jsx("span",{className:"text-sm font-bold text-white",children:t?.username||t?.email||"Admin"})]}),(0,n.jsxs)("button",{onClick:w,disabled:x,className:"flex items-center gap-2 px-4 py-2 bg-red-500/20 hover:bg-red-500/30 backdrop-blur-xl rounded-xl border border-red-500/30 hover:border-red-500/50 transition-all disabled:opacity-50",title:"Logout",children:[n.jsx(g.Z,{className:"w-4 h-4 text-red-400"}),n.jsx("span",{className:"hidden md:inline text-sm font-bold text-red-300",children:x?"Logging out...":"Logout"})]})]})]})}),(0,n.jsxs)("div",{className:"pt-20 flex relative",children:[(0,n.jsxs)("aside",{className:"hidden lg:block fixed left-0 top-20 bottom-0 w-72 backdrop-blur-xl bg-slate-900/40 border-r border-white/10 shadow-2xl",children:[n.jsx("nav",{className:"p-4 space-y-2",children:S.map(e=>{let t=r===e.href||"/crm"!==e.href&&r.startsWith(e.href),i=e.icon;return(0,n.jsxs)(a.default,{href:e.href,className:`flex items-center gap-4 px-6 py-4 rounded-2xl transition-all group ${t?"bg-gradient-to-r from-purple-500/30 to-pink-500/30 backdrop-blur-xl border border-purple-400/50 shadow-lg shadow-purple-500/25":"hover:bg-white/5 backdrop-blur-sm border border-transparent hover:border-white/10"}`,children:[n.jsx("div",{className:`p-2 rounded-xl ${t?"bg-gradient-to-br from-purple-500 to-pink-500 shadow-lg shadow-purple-500/50":"bg-white/5 group-hover:bg-white/10"}`,children:n.jsx(i,{className:"w-5 h-5 text-white"})}),n.jsx("span",{className:`font-bold ${t?"text-white":"text-gray-300 group-hover:text-white"}`,children:e.name}),t&&n.jsx("div",{className:"ml-auto w-2 h-2 rounded-full bg-gradient-to-r from-purple-400 to-pink-400 shadow-lg shadow-purple-500/50 animate-pulse"})]},e.name)})}),(0,n.jsxs)("div",{className:"absolute bottom-6 left-4 right-4 p-6 bg-gradient-to-br from-purple-500/20 to-pink-500/20 backdrop-blur-xl rounded-2xl border border-white/10 shadow-xl",children:[(0,n.jsxs)("div",{className:"flex items-center gap-3 mb-3",children:[n.jsx("div",{className:"w-2 h-2 rounded-full bg-emerald-400 animate-pulse shadow-lg shadow-emerald-400/50"}),n.jsx("p",{className:"text-xs text-white font-bold",children:"System Online"})]}),n.jsx("p",{className:"text-xs text-gray-300",children:"Premium CRM â€¢ Futuristic Edition"})]})]}),y&&n.jsx("div",{className:"lg:hidden fixed inset-0 top-20 z-30 bg-black/60 backdrop-blur-sm",onClick:()=>b(!1),children:n.jsx("aside",{className:"absolute left-0 top-0 bottom-0 w-72 backdrop-blur-xl bg-slate-900/95 border-r border-white/10 shadow-2xl",children:n.jsx("nav",{className:"p-4 space-y-2",children:S.map(e=>{let t=r===e.href||"/crm"!==e.href&&r.startsWith(e.href),i=e.icon;return(0,n.jsxs)(a.default,{href:e.href,onClick:()=>b(!1),className:`flex items-center gap-4 px-6 py-4 rounded-2xl transition-all ${t?"bg-gradient-to-r from-purple-500/30 to-pink-500/30 backdrop-blur-xl border border-purple-400/50 shadow-lg":"hover:bg-white/5 backdrop-blur-sm border border-transparent hover:border-white/10"}`,children:[n.jsx("div",{className:`p-2 rounded-xl ${t?"bg-gradient-to-br from-purple-500 to-pink-500":"bg-white/5"}`,children:n.jsx(i,{className:"w-5 h-5 text-white"})}),n.jsx("span",{className:`font-bold ${t?"text-white":"text-gray-300"}`,children:e.name})]},e.name)})})})}),n.jsx("main",{className:"lg:ml-72 flex-1 min-h-screen relative",children:n.jsx("div",{className:"p-8",children:e})})]})]})}},63428:(e,t,r)=>{"use strict";r.d(t,{Wp:()=>i,n$:()=>a}),r(15424);var n=r(46242);(0,n.$)("c4610c7d06ced3d0209d5cf7f5974e06a28a4d2d");var a=(0,n.$)("237c193e8d7301608cc32d64f4cf2cf85a3e4c2a"),i=(0,n.$)("e572bdf7c1d800e1f33185e76fd9c48c06806f07");(0,n.$)("7d201b312e9aa4dfb9228473a067d899b0e61886"),(0,n.$)("abf23e5f822cda97e111448432b6ad102f96474c"),(0,n.$)("5a5df8cbec3f078b35ff84be13abb5cda79f9184")},11506:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>i,metadata:()=>a});var n=r(19510);r(67272);let a={title:"LUXE VENUE - Premier Event Venue in Birmingham",description:"Luxury event venue for weddings, corporate events, and celebrations in Birmingham"};function i({children:e}){return(0,n.jsxs)("html",{lang:"en",children:[(0,n.jsxs)("head",{children:[n.jsx("script",{async:!0,src:"https://www.googletagmanager.com/gtag/js?id=G-04FV58WCCJ"}),n.jsx("script",{dangerouslySetInnerHTML:{__html:`
              window.dataLayer = window.dataLayer || [];
              function gtag(){dataLayer.push(arguments);}
              gtag('js', new Date());
              gtag('config', 'G-04FV58WCCJ');
            `}}),n.jsx("link",{rel:"preconnect",href:"https://fonts.googleapis.com"}),n.jsx("link",{rel:"preconnect",href:"https://fonts.gstatic.com",crossOrigin:"anonymous"}),n.jsx("link",{href:"https://fonts.googleapis.com/css2?family=Playfair+Display:wght@400;500;600;700;800&family=Montserrat:wght@300;400;500;600;700&family=Lato:wght@300;400;700&display=swap",rel:"stylesheet"})]}),n.jsx("body",{className:"antialiased bg-black-primary text-white",children:e})]})}},18208:(e,t,r)=>{"use strict";r.d(t,{Z:()=>n});let n=(0,r(68570).createProxy)(String.raw`/app/frontend/components/crm/CRMLayout.tsx#default`)},41168:(e,t,r)=>{"use strict";r.r(t),r.d(t,{convertLeadToBooking:()=>g,deleteBooking:()=>h,generateBookingPDF:()=>x,sendBookingConfirmation:()=>b,updateBooking:()=>f,updateBookingStatus:()=>y});var n=r(27745);r(26461);var a=r(71992),i=r(11185),s=r.n(i);let o=new i.Schema({id:{type:String,required:!0,unique:!0},bookingType:{type:String,enum:["venue","catering","hire"],required:!0},sourceLeadId:{type:String},sourceLeadType:{type:String,enum:["venue","catering","hire"]},clientName:{type:String,required:!0},clientEmail:{type:String,required:!0},clientPhone:{type:String,required:!0},eventType:{type:String,required:!0},date:{type:Date,required:!0},startTime:{type:String,required:!0},endTime:{type:String,required:!0},guestCount:{type:Number,required:!0},notes:{type:String},status:{type:String,enum:["tentative","confirmed","completed","cancelled"],default:"tentative"},totalAmount:{type:Number,default:0},discount:{type:Number,default:0},paidAmount:{type:Number,default:0},balanceDue:{type:Number,default:0},paymentStatus:{type:String,enum:["pending","partial","paid"],default:"pending"},menuDetails:{type:String},specialRequirements:{type:String},typeSpecificData:{type:i.Schema.Types.Mixed,default:{}}},{timestamps:!0,collection:"bookings"});o.index({date:1,status:1}),o.index({clientEmail:1}),o.index({bookingType:1}),o.index({sourceLeadId:1});let d=s().models.Booking||s().model("Booking",o);var c=r(61484),l=r(3272),u=r(64685),p=r(6866),m=r(30207);async function g(e,t,r){try{let n;if(await (0,a.u)(),!(n="venue"===t?await c.X.findById(e):"catering"===t?await l.u.findById(e):await u.f.findById(e)))return{success:!1,error:"Lead not found"};let i="venue"===t?{eventType:r.eventType||n.eventType||"",foodPackage:r.foodPackage||"standard",menuSelection:r.menuSelection||[],dietaryRequirements:r.dietaryRequirements||[],cateringNotes:r.cateringNotes||n.cateringNotes||"",decorPackage:r.decorPackage||"basic",decorTheme:r.decorTheme||"",decorItems:r.decorItems||[],decorNotes:r.decorNotes||"",roomSetup:r.roomSetup||"banquet",audioVisual:r.audioVisual||[],venueHireFee:r.venueHireFee||0,cateringFee:r.cateringFee||0,decorFee:r.decorFee||0,equipmentFee:r.equipmentFee||0,additionalServices:r.additionalServices||[]}:"catering"===t?{cuisineType:n.cuisineType||r.cuisineType||"",serviceType:r.serviceType||"buffet",courses:r.courses||[],menuItems:r.menuItems||[],chefOnSite:r.chefOnSite||!1,waitStaff:r.waitStaff||0,setupService:r.setupService||!1,cleanupService:r.cleanupService||!1,servingEquipment:r.servingEquipment||[],beverageService:r.beverageService||!1,deliveryLocation:n.location||r.deliveryLocation||"",deliveryTime:r.deliveryTime||"",setupTime:r.setupTime||"",perHeadPrice:r.perHeadPrice||0,serviceCharge:r.serviceCharge||0,equipmentCharge:r.equipmentCharge||0,deliveryCharge:r.deliveryCharge||0}:{spaceType:n.spaceType||r.spaceType||"",purpose:n.purpose||r.purpose||"",duration:r.duration||2,recurringBooking:r.recurringBooking||!1,frequency:r.frequency||void 0,requiredEquipment:r.requiredEquipment||[],audioSystem:r.audioSystem||!1,heatingCooling:r.heatingCooling||!1,storageSpace:r.storageSpace||!1,setupNeeded:r.setupNeeded||!1,specificRequirements:n.notes||r.specificRequirements||"",keyAccess:r.keyAccess||!1,securityDeposit:r.securityDeposit||0,hourlyRate:r.hourlyRate||0,additionalHours:r.additionalHours||0,equipmentCharge:r.equipmentCharge||0,cleaningFee:r.cleaningFee||0},s=r.totalAmount||0,o=r.discount||0,p=r.paidAmount||0;if(!r.date)return{success:!1,error:"Event date is required"};if(!r.startTime)return{success:!1,error:"Start time is required"};if(!r.endTime)return{success:!1,error:"End time is required"};if(!r.eventType&&!n.eventType&&!n.spaceType)return{success:!1,error:"Event type is required"};let g=await d.create({id:`BK-${Date.now()}`,bookingType:t,sourceLeadId:e,sourceLeadType:t,clientName:n.clientName,clientEmail:n.clientEmail,clientPhone:n.clientPhone||"N/A",eventType:r.eventType||n.eventType||n.spaceType||"",date:new Date(r.date),startTime:r.startTime,endTime:r.endTime,guestCount:r.guestCount||n.guestCount||50,totalAmount:s,discount:o,paidAmount:p,balanceDue:s-o-p,status:r.status||"tentative",notes:n.notes||"",menuDetails:r.menuDetails||"",specialRequirements:r.specialRequirements||"",typeSpecificData:i});return"venue"===t?await c.X.findByIdAndUpdate(e,{status:"converted"}):"catering"===t?await l.u.findByIdAndUpdate(e,{status:"converted"}):await u.f.findByIdAndUpdate(e,{status:"converted"}),(0,m.revalidatePath)("/crm/leads"),(0,m.revalidatePath)("/crm/bookings"),{success:!0,bookingId:g._id.toString()}}catch(e){return console.error("Error converting lead to booking:",e),{success:!1,error:e.message||"Failed to convert lead"}}}async function f(e,t){try{await (0,a.u)();let r=await d.findByIdAndUpdate(e,t,{new:!0});if(!r)return{success:!1,error:"Booking not found"};return(0,m.revalidatePath)("/crm/bookings"),{success:!0,booking:JSON.parse(JSON.stringify(r))}}catch(e){return console.error("Error updating booking:",e),{success:!1,error:"Failed to update booking"}}}async function h(e){try{return await (0,a.u)(),await d.findByIdAndDelete(e),(0,m.revalidatePath)("/crm/bookings"),{success:!0}}catch(e){return console.error("Error deleting booking:",e),{success:!1,error:"Failed to delete booking"}}}async function y(e,t){try{if(await (0,a.u)(),!await d.findByIdAndUpdate(e,{status:t},{new:!0}))return{success:!1,error:"Booking not found"};return(0,m.revalidatePath)("/crm/bookings"),{success:!0}}catch(e){return console.error("Error updating booking status:",e),{success:!1,error:"Failed to update status"}}}async function b(e){try{await (0,a.u)();let t=await d.findById(e);if(!t)return{success:!1,error:"Booking not found"};let r=`
      <div style="font-family: Arial, sans-serif; max-width: 600px; margin: 0 auto; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); padding: 2px; border-radius: 12px;">
        <div style="background: white; padding: 40px; border-radius: 10px;">
          <h1 style="color: #667eea; margin: 0 0 20px 0; font-size: 28px;">Booking Confirmed</h1>
          <p style="color: #333; font-size: 16px; line-height: 1.6;">Dear ${t.clientName},</p>
          <p style="color: #333; font-size: 16px; line-height: 1.6;">Your booking at LUXE VENUE has been confirmed!</p>
          
          <div style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); padding: 20px; border-radius: 8px; margin: 25px 0;">
            <h2 style="color: white; margin: 0 0 15px 0; font-size: 20px;">Booking Details</h2>
            <table style="width: 100%; color: white;">
              <tr><td style="padding: 8px 0;"><strong>Event:</strong></td><td style="padding: 8px 0;">${t.eventType}</td></tr>
              <tr><td style="padding: 8px 0;"><strong>Date:</strong></td><td style="padding: 8px 0;">${t.date}</td></tr>
              <tr><td style="padding: 8px 0;"><strong>Time:</strong></td><td style="padding: 8px 0;">${t.startTime} - ${t.endTime}</td></tr>
              <tr><td style="padding: 8px 0;"><strong>Guests:</strong></td><td style="padding: 8px 0;">${t.guestCount}</td></tr>
              ${t.totalAmount?`<tr><td style="padding: 8px 0;"><strong>Total:</strong></td><td style="padding: 8px 0;">\xa3${t.totalAmount}</td></tr>`:""}
            </table>
          </div>
          
          <p style="color: #333; font-size: 16px; line-height: 1.6;">For any queries, contact us:</p>
          <p style="color: #667eea; font-size: 16px; margin: 5px 0;">ðŸ“ž +44 7391 222884</p>
          <p style="color: #667eea; font-size: 16px; margin: 5px 0;">ðŸ“§ info@luxevenue.co.uk</p>
          
          <div style="margin-top: 30px; padding-top: 20px; border-top: 2px solid #eee; text-align: center; color: #999; font-size: 14px;">
            <p>LUXE VENUE | 86 Leopold Street, Birmingham B12 0UD</p>
          </div>
        </div>
      </div>
    `;return await (0,p.Cz)({to:t.clientEmail,subject:`Booking Confirmation - ${t.eventType} - LUXE VENUE`,html:r}),{success:!0}}catch(e){return console.error("Error sending confirmation:",e),{success:!1,error:"Failed to send email"}}}async function x(e){try{await (0,a.u)();let t=await d.findById(e);if(!t)return{success:!1,error:"Booking not found"};let r={bookingId:t._id.toString(),clientName:t.clientName,clientEmail:t.clientEmail,clientPhone:t.clientPhone,eventType:t.eventType,date:t.date,time:`${t.startTime} - ${t.endTime}`,guests:t.guestCount,totalAmount:t.totalAmount,paidAmount:t.paidAmount,balance:(t.totalAmount||0)-(t.paidAmount||0),status:t.status};return{success:!0,pdfData:r}}catch(e){return console.error("Error generating PDF:",e),{success:!1,error:"Failed to generate PDF"}}}(0,r(85723).h)([g,f,h,y,b,x]),(0,n.j)("237c193e8d7301608cc32d64f4cf2cf85a3e4c2a",g),(0,n.j)("e572bdf7c1d800e1f33185e76fd9c48c06806f07",f),(0,n.j)("7d201b312e9aa4dfb9228473a067d899b0e61886",h),(0,n.j)("abf23e5f822cda97e111448432b6ad102f96474c",y),(0,n.j)("5a5df8cbec3f078b35ff84be13abb5cda79f9184",b),(0,n.j)("c4610c7d06ced3d0209d5cf7f5974e06a28a4d2d",x)},91373:(e,t,r)=>{"use strict";r.d(t,{t:()=>i});var n=r(71615),a=r(73840);async function i(){try{let e=(0,n.cookies)(),t=e.get(a.B$)?.value;if(!t)return null;let r=await (0,a.WX)(t);if(!r)return null;return{id:r.userId,userId:r.userId,email:r.email,username:r.username,role:r.role}}catch(e){return console.error("Get current user error:",e),null}}},73840:(e,t,r)=>{"use strict";r.d(t,{$Q:()=>l,B$:()=>c,V3:()=>o,WX:()=>d});var n=r(86890),a=r(41463);let i=process.env.JWT_SECRET||"fallback-secret-key-change-in-production",s=new TextEncoder().encode(i);async function o(e){return await new n.N(e).setProtectedHeader({alg:"HS256"}).setIssuedAt().setExpirationTime("7d").sign(s)}async function d(e){try{let{payload:t}=await (0,a._)(e,s);return t}catch(e){return null}}let c="luxe_crm_session";function l(e=!0){return{httpOnly:!0,secure:e,sameSite:"lax",path:"/",maxAge:604800}}},71992:(e,t,r)=>{"use strict";r.d(t,{u:()=>o});var n=r(11185),a=r.n(n);let i=process.env.MONGODB_URI;if(!i)throw Error("Please define the MONGODB_URI environment variable inside .env.local");let s=global.mongoose;async function o(){if(s.conn)return s.conn;s.promise||(s.promise=a().connect(i,{bufferCommands:!1}));try{s.conn=await s.promise}catch(e){throw s.promise=null,e}return s.conn}s||(s=global.mongoose={conn:null,promise:null})},83820:(e,t,r)=>{"use strict";r.d(t,{M:()=>d,u:()=>o});var n=r(11185),a=r.n(n);let i=process.env.MONGODB_URI;if(!i)throw Error("Please define the MONGODB_URI environment variable inside .env.local");let s=global.mongoose;async function o(){if(s.conn)return s.conn;s.promise||(s.promise=a().connect(i,{bufferCommands:!1}));try{s.conn=await s.promise}catch(e){throw s.promise=null,e}return s.conn}function d(){return 1===a().connection.readyState}s||(s=global.mongoose={conn:null,promise:null})},6866:(e,t,r)=>{"use strict";r.d(t,{Cz:()=>u});var n=r(38160),a=r(71992),i=r(11185),s=r.n(i);let o=new(s()).Schema({id:{type:String,required:!0,unique:!0},type:{type:String,required:!0},recipient:{type:String,required:!0},recipientEmail:{type:String,required:!0},subject:{type:String,required:!0},status:{type:String,enum:["sent","failed","pending"],default:"pending"},messageId:String,leadId:String,bookingId:String,leadType:{type:String,enum:["event","catering","hire"]},error:String,sentAt:{type:Date,default:Date.now},metadata:s().Schema.Types.Mixed},{timestamps:!0});o.index({leadId:1}),o.index({bookingId:1}),o.index({sentAt:-1}),o.index({recipientEmail:1});let d=s().models.EmailLog||s().model("EmailLog",o);var c=r(20411);let l=n.createTransport({host:process.env.SMTP_HOST,port:parseInt(process.env.SMTP_PORT||"587"),secure:!1,auth:{user:process.env.SMTP_USER,pass:process.env.SMTP_PASSWORD}});async function u({to:e,subject:t,html:r,cc:n,attachments:i,emailType:s="general",leadId:o,bookingId:u,leadType:p,recipientName:m}){let g=(0,c.Z)(),f=Array.isArray(e)?e[0]:e;try{let c=await l.sendMail({from:`"${process.env.SENDER_NAME}" <${process.env.SENDER_EMAIL}>`,to:Array.isArray(e)?e.join(", "):e,cc:n?Array.isArray(n)?n.join(", "):n:void 0,subject:t,html:r,attachments:i||[]});console.log("Email sent:",c.messageId);try{await (0,a.u)(),await d.create({id:g,type:s,recipient:m||f,recipientEmail:f,subject:t,status:"sent",messageId:c.messageId,leadId:o,bookingId:u,leadType:p,sentAt:new Date,metadata:{hasAttachments:i&&i.length>0,cc:n}})}catch(e){console.error("Failed to log email to database:",e)}return{success:!0,messageId:c.messageId,emailLogId:g}}catch(e){console.error("Error sending email:",e);try{await (0,a.u)(),await d.create({id:g,type:s,recipient:m||f,recipientEmail:f,subject:t,status:"failed",leadId:o,bookingId:u,leadType:p,error:String(e),sentAt:new Date})}catch(e){console.error("Failed to log failed email:",e)}return{success:!1,error:String(e)}}}},3272:(e,t,r)=>{"use strict";r.d(t,{u:()=>s});var n=r(11185),a=r.n(n);let i=new n.Schema({id:{type:String,required:!0,unique:!0},name:{type:String,required:!0},email:{type:String},phone:{type:String},source:{type:String,required:!0},status:{type:String,enum:["New","Contacted","Qualified","Converted","Lost"],default:"New"},interestedIn:{type:String},nextFollowUpDate:{type:Date},lastContactedAt:{type:Date},convertedToEnquiryId:{type:String},notes:[{text:{type:String},addedAt:{type:Date,default:Date.now},addedBy:{type:String}}]},{timestamps:!0,collection:"leads"});i.index({createdAt:-1,status:1});let s=a().models.CateringLead||a().model("CateringLead",i)},64685:(e,t,r)=>{"use strict";r.d(t,{f:()=>s});var n=r(11185),a=r.n(n);let i=new n.Schema({id:{type:String,required:!0,unique:!0},name:{type:String,required:!0},email:{type:String,required:!0},phone:{type:String,required:!0},eventType:{type:String,required:!0},date:{type:Date},startTime:{type:String},endTime:{type:String},guestCount:{type:Number},message:{type:String},status:{type:String,enum:["New","Contacted","Converted","Lost"],default:"New"},source:{type:String,required:!0},sourceUrl:{type:String},contactedAt:{type:Date},convertedToBookingId:{type:String},lostReason:{type:String},receivedAt:{type:Date,default:Date.now},notes:[{text:{type:String},addedAt:{type:Date,default:Date.now},addedBy:{type:String}}]},{timestamps:!0,collection:"hire_leads"});i.index({receivedAt:-1,status:1}),i.index({email:1}),i.index({date:1});let s=a().models.HireLead||a().model("HireLead",i)},61484:(e,t,r)=>{"use strict";r.d(t,{X:()=>s});var n=r(11185),a=r.n(n);let i=new n.Schema({id:{type:String,required:!0,unique:!0},name:{type:String,required:!0},email:{type:String,required:!0},phone:{type:String,required:!0},eventType:{type:String,required:!0},eventDate:{type:Date},numberOfGuests:{type:Number},message:{type:String},status:{type:String,enum:["New","Contacted","Converted","Lost"],default:"New"},source:{type:String,required:!0},sourceUrl:{type:String},contactedAt:{type:Date},convertedToBookingId:{type:String},lostReason:{type:String},receivedAt:{type:Date,default:Date.now},notes:[{text:{type:String},addedAt:{type:Date,default:Date.now},addedBy:{type:String}}]},{timestamps:!0,collection:"enquiries"});i.index({receivedAt:-1,status:1}),i.index({email:1});let s=a().models.VenueLead||a().model("VenueLead",i)},67272:()=>{}};