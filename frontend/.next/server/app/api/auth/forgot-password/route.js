"use strict";(()=>{var e={};e.id=9118,e.ids=[9118],e.modules={11185:e=>{e.exports=require("mongoose")},20399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},84770:e=>{e.exports=require("crypto")},30674:(e,r,t)=>{t.r(r),t.d(r,{originalPathname:()=>f,patchFetch:()=>x,requestAsyncStorage:()=>g,routeModule:()=>m,serverHooks:()=>w,staticGenerationAsyncStorage:()=>h});var s={};t.r(s),t.d(s,{POST:()=>l});var o=t(49303),n=t(88716),a=t(60670),i=t(87070),u=t(84770),p=t.n(u),d=t(83820),c=t(2690);async function l(e){try{let{email:r}=await e.json();if(!r)return i.NextResponse.json({success:!1,error:"Email is required"},{status:400});await (0,d.u)();let t=await c.n.findOne({email:r.toLowerCase()});if(!t)return i.NextResponse.json({success:!0,message:"If an account exists with this email, a password reset link has been sent."});let s=p().randomBytes(32).toString("hex"),o=p().createHash("sha256").update(s).digest("hex");t.resetPasswordToken=o,t.resetPasswordExpires=new Date(Date.now()+36e5),await t.save();let n=`${process.env.NEXT_PUBLIC_SITE_URL||"http://localhost:3000"}/crm/reset-password?token=${s}`;return console.log("Password reset URL:",n),console.log("Reset token:",s),i.NextResponse.json({success:!0,message:"If an account exists with this email, a password reset link has been sent.",...!1})}catch(e){return console.error("Forgot password error:",e),i.NextResponse.json({success:!1,error:"Internal server error"},{status:500})}}let m=new o.AppRouteRouteModule({definition:{kind:n.x.APP_ROUTE,page:"/api/auth/forgot-password/route",pathname:"/api/auth/forgot-password",filename:"route",bundlePath:"app/api/auth/forgot-password/route"},resolvedPagePath:"/app/frontend/app/api/auth/forgot-password/route.ts",nextConfigOutput:"",userland:s}),{requestAsyncStorage:g,staticGenerationAsyncStorage:h,serverHooks:w}=m,f="/api/auth/forgot-password/route";function x(){return(0,a.patchFetch)({serverHooks:w,staticGenerationAsyncStorage:h})}},83820:(e,r,t)=>{t.d(r,{M:()=>u,u:()=>i});var s=t(11185),o=t.n(s);let n=process.env.MONGODB_URI;if(!n)throw Error("Please define the MONGODB_URI environment variable inside .env.local");let a=global.mongoose;async function i(){if(a.conn)return a.conn;a.promise||(a.promise=o().connect(n,{bufferCommands:!1}));try{a.conn=await a.promise}catch(e){throw a.promise=null,e}return a.conn}function u(){return 1===o().connection.readyState}a||(a=global.mongoose={conn:null,promise:null})},2690:(e,r,t)=>{t.d(r,{n:()=>a});var s=t(11185),o=t.n(s);let n=new s.Schema({id:{type:String,required:!0,unique:!0},username:{type:String,required:!0,unique:!0,lowercase:!0},email:{type:String,required:!0},password:{type:String,required:!0},role:{type:String,enum:["admin","staff"],default:"staff"},firstName:{type:String},lastName:{type:String},resetPasswordToken:{type:String},resetPasswordExpires:{type:Date}},{timestamps:!0}),a=o().models.User||o().model("User",n)}};var r=require("../../../../webpack-runtime.js");r.C(e);var t=e=>r(r.s=e),s=r.X(0,[8948,5972],()=>t(30674));module.exports=s})();