"use strict";(()=>{var e={};e.id=9436,e.ids=[9436],e.modules={11185:e=>{e.exports=require("mongoose")},20399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},84770:e=>{e.exports=require("crypto")},93315:(e,r,s)=>{s.r(r),s.d(r,{originalPathname:()=>x,patchFetch:()=>v,requestAsyncStorage:()=>h,routeModule:()=>w,serverHooks:()=>f,staticGenerationAsyncStorage:()=>g});var t={};s.r(t),s.d(t,{POST:()=>m});var n=s(49303),o=s(88716),a=s(60670),i=s(87070),u=s(84770),p=s.n(u),d=s(98691),c=s(83820),l=s(2690);async function m(e){try{let{token:r,password:s}=await e.json();if(!r||!s)return i.NextResponse.json({success:!1,error:"Token and password are required"},{status:400});if(s.length<8)return i.NextResponse.json({success:!1,error:"Password must be at least 8 characters long"},{status:400});await (0,c.u)();let t=p().createHash("sha256").update(r).digest("hex"),n=await l.n.findOne({resetPasswordToken:t,resetPasswordExpires:{$gt:new Date}});if(!n)return i.NextResponse.json({success:!1,error:"Invalid or expired reset token"},{status:400});let o=await d.ZP.hash(s,12);return n.password=o,n.resetPasswordToken=void 0,n.resetPasswordExpires=void 0,await n.save(),i.NextResponse.json({success:!0,message:"Password has been reset successfully. You can now login with your new password."})}catch(e){return console.error("Reset password error:",e),i.NextResponse.json({success:!1,error:"Internal server error"},{status:500})}}let w=new n.AppRouteRouteModule({definition:{kind:o.x.APP_ROUTE,page:"/api/auth/reset-password/route",pathname:"/api/auth/reset-password",filename:"route",bundlePath:"app/api/auth/reset-password/route"},resolvedPagePath:"/app/frontend/app/api/auth/reset-password/route.ts",nextConfigOutput:"",userland:t}),{requestAsyncStorage:h,staticGenerationAsyncStorage:g,serverHooks:f}=w,x="/api/auth/reset-password/route";function v(){return(0,a.patchFetch)({serverHooks:f,staticGenerationAsyncStorage:g})}},83820:(e,r,s)=>{s.d(r,{M:()=>u,u:()=>i});var t=s(11185),n=s.n(t);let o=process.env.MONGODB_URI;if(!o)throw Error("Please define the MONGODB_URI environment variable inside .env.local");let a=global.mongoose;async function i(){if(a.conn)return a.conn;a.promise||(a.promise=n().connect(o,{bufferCommands:!1}));try{a.conn=await a.promise}catch(e){throw a.promise=null,e}return a.conn}function u(){return 1===n().connection.readyState}a||(a=global.mongoose={conn:null,promise:null})},2690:(e,r,s)=>{s.d(r,{n:()=>a});var t=s(11185),n=s.n(t);let o=new t.Schema({id:{type:String,required:!0,unique:!0},username:{type:String,required:!0,unique:!0,lowercase:!0},email:{type:String,required:!0},password:{type:String,required:!0},role:{type:String,enum:["admin","staff"],default:"staff"},firstName:{type:String},lastName:{type:String},resetPasswordToken:{type:String},resetPasswordExpires:{type:Date}},{timestamps:!0}),a=n().models.User||n().model("User",o)}};var r=require("../../../../webpack-runtime.js");r.C(e);var s=e=>r(r.s=e),t=r.X(0,[8948,5972,8691],()=>s(93315));module.exports=t})();