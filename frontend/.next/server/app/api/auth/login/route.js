"use strict";(()=>{var e={};e.id=8873,e.ids=[8873],e.modules={11185:e=>{e.exports=require("mongoose")},20399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},84770:e=>{e.exports=require("crypto")},32992:(e,r,t)=>{t.r(r),t.d(r,{originalPathname:()=>w,patchFetch:()=>v,requestAsyncStorage:()=>g,routeModule:()=>f,serverHooks:()=>h,staticGenerationAsyncStorage:()=>y});var i={};t.r(i),t.d(i,{POST:()=>m});var a=t(49303),n=t(88716),o=t(60670),s=t(87070),u=t(98691),p=t(83820),l=t(2690),c=t(73840),d=t(83543);async function m(e){try{let{username:r,password:t}=await e.json();if(!r||!t)return s.NextResponse.json({success:!1,error:"Username and password are required"},{status:400});await (0,p.u)();let i=await l.n.findOne({username:r.toLowerCase()});if(!i||!await u.ZP.compare(t,i.password))return s.NextResponse.json({success:!1,error:"Invalid username or password"},{status:401});let a=await (0,c.V3)({userId:i.id,email:i.email,username:i.username,role:i.role}),n=(0,d.qC)(c.B$,a,(0,c.$Q)()),o=s.NextResponse.json({success:!0,user:{id:i.id,username:i.username,email:i.email,role:i.role}},{status:200});return o.headers.set("Set-Cookie",n),o}catch(e){return console.error("Login error:",e),s.NextResponse.json({success:!1,error:"Internal server error"},{status:500})}}let f=new a.AppRouteRouteModule({definition:{kind:n.x.APP_ROUTE,page:"/api/auth/login/route",pathname:"/api/auth/login",filename:"route",bundlePath:"app/api/auth/login/route"},resolvedPagePath:"/app/frontend/app/api/auth/login/route.ts",nextConfigOutput:"",userland:i}),{requestAsyncStorage:g,staticGenerationAsyncStorage:y,serverHooks:h}=f,w="/api/auth/login/route";function v(){return(0,o.patchFetch)({serverHooks:h,staticGenerationAsyncStorage:y})}},73840:(e,r,t)=>{t.d(r,{$Q:()=>l,B$:()=>p,V3:()=>s,WX:()=>u});var i=t(86890),a=t(41463);let n=process.env.JWT_SECRET||"fallback-secret-key-change-in-production",o=new TextEncoder().encode(n);async function s(e){return await new i.N(e).setProtectedHeader({alg:"HS256"}).setIssuedAt().setExpirationTime("7d").sign(o)}async function u(e){try{let{payload:r}=await (0,a._)(e,o);return r}catch(e){return null}}let p="luxe_crm_session";function l(e=!0){return{httpOnly:!0,secure:e,sameSite:"lax",path:"/",maxAge:604800}}},83820:(e,r,t)=>{t.d(r,{M:()=>u,u:()=>s});var i=t(11185),a=t.n(i);let n=process.env.MONGODB_URI;if(!n)throw Error("Please define the MONGODB_URI environment variable inside .env.local");let o=global.mongoose;async function s(){if(o.conn)return o.conn;o.promise||(o.promise=a().connect(n,{bufferCommands:!1}));try{o.conn=await o.promise}catch(e){throw o.promise=null,e}return o.conn}function u(){return 1===a().connection.readyState}o||(o=global.mongoose={conn:null,promise:null})},2690:(e,r,t)=>{t.d(r,{n:()=>o});var i=t(11185),a=t.n(i);let n=new i.Schema({id:{type:String,required:!0,unique:!0},username:{type:String,required:!0,unique:!0,lowercase:!0},email:{type:String,required:!0},password:{type:String,required:!0},role:{type:String,enum:["admin","staff"],default:"staff"},firstName:{type:String},lastName:{type:String},resetPasswordToken:{type:String},resetPasswordExpires:{type:Date}},{timestamps:!0}),o=a().models.User||a().model("User",n)},83543:(e,r)=>{r.qC=s,r.qC=s;let t=/^[\u0021-\u003A\u003C\u003E-\u007E]+$/,i=/^[\u0021-\u003A\u003C-\u007E]*$/,a=/^([.]?[a-z0-9]([a-z0-9-]{0,61}[a-z0-9])?)([.][a-z0-9]([a-z0-9-]{0,61}[a-z0-9])?)*$/i,n=/^[\u0020-\u003A\u003D-\u007E]*$/,o=Object.prototype.toString;function s(e,r,s){let u="object"==typeof e?e:{...s,name:e,value:String(r)},p=("object"==typeof r?r:s)?.encode||encodeURIComponent;if(!t.test(u.name))throw TypeError(`argument name is invalid: ${u.name}`);let l=u.value?p(u.value):"";if(!i.test(l))throw TypeError(`argument val is invalid: ${u.value}`);let c=u.name+"="+l;if(void 0!==u.maxAge){if(!Number.isInteger(u.maxAge))throw TypeError(`option maxAge is invalid: ${u.maxAge}`);c+="; Max-Age="+u.maxAge}if(u.domain){if(!a.test(u.domain))throw TypeError(`option domain is invalid: ${u.domain}`);c+="; Domain="+u.domain}if(u.path){if(!n.test(u.path))throw TypeError(`option path is invalid: ${u.path}`);c+="; Path="+u.path}if(u.expires){var d;if(d=u.expires,"[object Date]"!==o.call(d)||!Number.isFinite(u.expires.valueOf()))throw TypeError(`option expires is invalid: ${u.expires}`);c+="; Expires="+u.expires.toUTCString()}if(u.httpOnly&&(c+="; HttpOnly"),u.secure&&(c+="; Secure"),u.partitioned&&(c+="; Partitioned"),u.priority)switch("string"==typeof u.priority?u.priority.toLowerCase():void 0){case"low":c+="; Priority=Low";break;case"medium":c+="; Priority=Medium";break;case"high":c+="; Priority=High";break;default:throw TypeError(`option priority is invalid: ${u.priority}`)}if(u.sameSite)switch("string"==typeof u.sameSite?u.sameSite.toLowerCase():u.sameSite){case!0:case"strict":c+="; SameSite=Strict";break;case"lax":c+="; SameSite=Lax";break;case"none":c+="; SameSite=None";break;default:throw TypeError(`option sameSite is invalid: ${u.sameSite}`)}return c}}};var r=require("../../../../webpack-runtime.js");r.C(e);var t=e=>r(r.s=e),i=r.X(0,[8948,5972,1814,8691],()=>t(32992));module.exports=i})();