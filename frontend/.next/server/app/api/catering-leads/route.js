"use strict";(()=>{var e={};e.id=6548,e.ids=[6548],e.modules={11185:e=>{e.exports=require("mongoose")},20399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},61282:e=>{e.exports=require("child_process")},84770:e=>{e.exports=require("crypto")},80665:e=>{e.exports=require("dns")},17702:e=>{e.exports=require("events")},92048:e=>{e.exports=require("fs")},32615:e=>{e.exports=require("http")},35240:e=>{e.exports=require("https")},98216:e=>{e.exports=require("net")},19801:e=>{e.exports=require("os")},55315:e=>{e.exports=require("path")},76162:e=>{e.exports=require("stream")},82452:e=>{e.exports=require("tls")},17360:e=>{e.exports=require("url")},21764:e=>{e.exports=require("util")},71568:e=>{e.exports=require("zlib")},6005:e=>{e.exports=require("node:crypto")},60265:(e,t,r)=>{r.r(t),r.d(t,{originalPathname:()=>E,patchFetch:()=>q,requestAsyncStorage:()=>f,routeModule:()=>x,serverHooks:()=>v,staticGenerationAsyncStorage:()=>h});var n={};r.r(n),r.d(n,{GET:()=>m,POST:()=>y});var a=r(49303),i=r(88716),o=r(60670),s=r(87070),d=r(83820),l=r(16906),p=r(30070),c=r(82234),u=r(96263);let g=u.Ryn({clientName:u.Z_8().min(2,"Name must be at least 2 characters"),clientEmail:u.Z_8().email("Invalid email address"),clientPhone:u.Z_8().min(10,"Phone number must be at least 10 digits"),eventType:u.Z_8().min(1,"Event type is required"),cuisineType:u.Z_8().optional(),eventDate:u.Z_8().optional(),guestCount:u.Rxh().optional(),location:u.Z_8().optional(),notes:u.Z_8().optional(),sourcePage:u.Z_8().optional(),status:u.KmV(["new","contacted","qualified","converted","lost"]).default("new")});async function y(e){try{await (0,d.u)();let t=await e.json(),r=g.parse(t),n=await l.u.create(r),a=`
      <div style="font-family: Arial, sans-serif; max-width: 600px; margin: 0 auto;">
        <div style="background: linear-gradient(135deg, #1a1a1a, #2d2d2d); padding: 30px; text-align: center;">
          <h1 style="color: #d4af37; margin: 0; font-size: 32px; letter-spacing: 2px;">LUXE VENUE</h1>
        </div>
        <div style="padding: 40px; background: #ffffff;">
          <h2 style="color: #1a1a1a; border-bottom: 2px solid #d4af37; padding-bottom: 10px;">New Catering Enquiry</h2>
          <table style="width: 100%; margin-top: 20px;">
            <tr><td style="padding: 10px 0; color: #666;"><strong>Name:</strong></td><td style="padding: 10px 0; color: #333;">${r.clientName}</td></tr>
            <tr><td style="padding: 10px 0; color: #666;"><strong>Email:</strong></td><td style="padding: 10px 0; color: #333;">${r.clientEmail}</td></tr>
            <tr><td style="padding: 10px 0; color: #666;"><strong>Phone:</strong></td><td style="padding: 10px 0; color: #333;">${r.clientPhone}</td></tr>
            <tr><td style="padding: 10px 0; color: #666;"><strong>Event Type:</strong></td><td style="padding: 10px 0; color: #333;">${r.eventType}</td></tr>
            ${r.cuisineType?`<tr><td style="padding: 10px 0; color: #666;"><strong>Cuisine:</strong></td><td style="padding: 10px 0; color: #333;">${r.cuisineType}</td></tr>`:""}
            ${r.eventDate?`<tr><td style="padding: 10px 0; color: #666;"><strong>Event Date:</strong></td><td style="padding: 10px 0; color: #333;">${r.eventDate}</td></tr>`:""}
            ${r.guestCount?`<tr><td style="padding: 10px 0; color: #666;"><strong>Guests:</strong></td><td style="padding: 10px 0; color: #333;">${r.guestCount}</td></tr>`:""}
            ${r.location?`<tr><td style="padding: 10px 0; color: #666;"><strong>Location:</strong></td><td style="padding: 10px 0; color: #333;">${r.location}</td></tr>`:""}
            ${r.notes?`<tr><td style="padding: 10px 0; color: #666; vertical-align: top;"><strong>Message:</strong></td><td style="padding: 10px 0; color: #333;">${r.notes}</td></tr>`:""}
          </table>
        </div>
        <div style="background: #f8f8f8; padding: 20px; text-align: center; color: #666; font-size: 14px;">
          <p>Login to CRM to manage this lead</p>
        </div>
      </div>
    `;await (0,c.Cz)({to:"info@luxevenue.co.uk",cc:"info.luxevenuebirmingham@gmail.com",subject:`New Catering Enquiry: ${r.eventType}`,html:a});let i=`
      <div style="font-family: Arial, sans-serif; max-width: 600px; margin: 0 auto;">
        <div style="background: linear-gradient(135deg, #1a1a1a, #2d2d2d); padding: 30px; text-align: center;">
          <h1 style="color: #d4af37; margin: 0; font-size: 32px; letter-spacing: 2px;">LUXE VENUE</h1>
        </div>
        <div style="padding: 40px; background: #ffffff;">
          <h2 style="color: #1a1a1a;">Thank You for Your Catering Enquiry!</h2>
          <p style="color: #333; line-height: 1.6; font-size: 16px;">Dear ${r.clientName},</p>
          <p style="color: #333; line-height: 1.6; font-size: 16px;">Thank you for considering LUXE VENUE Catering. We've received your enquiry and our catering team will respond within 24 hours with menu options and pricing.</p>
          
          <div style="background: #fef9e7; border-left: 4px solid #d4af37; padding: 20px; margin: 25px 0;">
            <h3 style="color: #1a1a1a; margin-top: 0;">Your Enquiry Details</h3>
            <p style="color: #333; margin: 5px 0;"><strong>Event Type:</strong> ${r.eventType}</p>
            ${r.cuisineType?`<p style="color: #333; margin: 5px 0;"><strong>Cuisine:</strong> ${r.cuisineType}</p>`:""}
            ${r.eventDate?`<p style="color: #333; margin: 5px 0;"><strong>Date:</strong> ${r.eventDate}</p>`:""}
            ${r.guestCount?`<p style="color: #333; margin: 5px 0;"><strong>Guests:</strong> ${r.guestCount}</p>`:""}
          </div>
          
          <p style="color: #333; line-height: 1.6; font-size: 16px;">For immediate assistance, contact us:</p>
          <p style="color: #333; line-height: 1.6;">
            ðŸ“ž <strong>Phone:</strong> <a href="tel:+447391222884" style="color: #d4af37;">+44 7391 222884</a><br/>
            ðŸ’¬ <strong>WhatsApp:</strong> <a href="https://wa.me/447391222884" style="color: #d4af37;">Chat with us</a><br/>
            ðŸ“§ <strong>Email:</strong> <a href="mailto:info@luxevenue.co.uk" style="color: #d4af37;">info@luxevenue.co.uk</a>
          </p>
        </div>
        <div style="background: #f8f8f8; padding: 20px; text-align: center; color: #666; font-size: 14px;">
          <p>LUXE VENUE | 86 Leopold Street, Birmingham B12 0UD</p>
        </div>
      </div>
    `;return await (0,c.Cz)({to:r.clientEmail,subject:"Thank You for Your Catering Enquiry - LUXE VENUE",html:i}),await p.k.create({to:"info@luxevenue.co.uk",subject:`New Catering Enquiry: ${r.eventType}`,leadId:n._id,leadType:"catering",status:"sent"}),await p.k.create({to:r.clientEmail,subject:"Thank You for Your Catering Enquiry - LUXE VENUE",leadId:n._id,leadType:"catering",status:"sent"}),s.NextResponse.json({success:!0,leadId:n._id})}catch(e){return console.error("Error creating catering lead:",e),s.NextResponse.json({success:!1,error:e.message||"Failed to submit enquiry"},{status:500})}}async function m(e){try{await (0,d.u)();let{searchParams:t}=new URL(e.url),r=t.get("status"),n={};r&&(n.status=r);let a=await l.u.find(n).sort({createdAt:-1}).limit(100);return s.NextResponse.json(a)}catch(e){return console.error("Error fetching catering leads:",e),s.NextResponse.json({error:"Failed to fetch leads"},{status:500})}}let x=new a.AppRouteRouteModule({definition:{kind:i.x.APP_ROUTE,page:"/api/catering-leads/route",pathname:"/api/catering-leads",filename:"route",bundlePath:"app/api/catering-leads/route"},resolvedPagePath:"/app/frontend/app/api/catering-leads/route.ts",nextConfigOutput:"",userland:n}),{requestAsyncStorage:f,staticGenerationAsyncStorage:h,serverHooks:v}=x,E="/api/catering-leads/route";function q(){return(0,o.patchFetch)({serverHooks:v,staticGenerationAsyncStorage:h})}},83820:(e,t,r)=>{r.d(t,{M:()=>d,u:()=>s});var n=r(11185),a=r.n(n);let i=process.env.MONGODB_URI;if(!i)throw Error("Please define the MONGODB_URI environment variable inside .env.local");let o=global.mongoose;async function s(){if(o.conn)return o.conn;o.promise||(o.promise=a().connect(i,{bufferCommands:!1}));try{o.conn=await o.promise}catch(e){throw o.promise=null,e}return o.conn}function d(){return 1===a().connection.readyState}o||(o=global.mongoose={conn:null,promise:null})},82234:(e,t,r)=>{r.d(t,{Cz:()=>d});var n=r(55245),a=r(83820),i=r(30070),o=r(38547);let s=n.createTransport({host:process.env.SMTP_HOST,port:parseInt(process.env.SMTP_PORT||"587"),secure:!1,auth:{user:process.env.SMTP_USER,pass:process.env.SMTP_PASSWORD}});async function d({to:e,subject:t,html:r,cc:n,attachments:d,emailType:l="general",leadId:p,bookingId:c,leadType:u,recipientName:g}){let y=(0,o.Z)(),m=Array.isArray(e)?e[0]:e;try{let o=await s.sendMail({from:`"${process.env.SENDER_NAME}" <${process.env.SENDER_EMAIL}>`,to:Array.isArray(e)?e.join(", "):e,cc:n?Array.isArray(n)?n.join(", "):n:void 0,subject:t,html:r,attachments:d||[]});console.log("Email sent:",o.messageId);try{await (0,a.u)(),await i.k.create({id:y,type:l,recipient:g||m,recipientEmail:m,subject:t,status:"sent",messageId:o.messageId,leadId:p,bookingId:c,leadType:u,sentAt:new Date,metadata:{hasAttachments:d&&d.length>0,cc:n}})}catch(e){console.error("Failed to log email to database:",e)}return{success:!0,messageId:o.messageId,emailLogId:y}}catch(e){console.error("Error sending email:",e);try{await (0,a.u)(),await i.k.create({id:y,type:l,recipient:g||m,recipientEmail:m,subject:t,status:"failed",leadId:p,bookingId:c,leadType:u,error:String(e),sentAt:new Date})}catch(e){console.error("Failed to log failed email:",e)}return{success:!1,error:String(e)}}}},16906:(e,t,r)=>{r.d(t,{u:()=>o});var n=r(11185),a=r.n(n);let i=new n.Schema({id:{type:String,required:!0,unique:!0},name:{type:String,required:!0},email:{type:String},phone:{type:String},source:{type:String,required:!0},status:{type:String,enum:["New","Contacted","Qualified","Converted","Lost"],default:"New"},interestedIn:{type:String},nextFollowUpDate:{type:Date},lastContactedAt:{type:Date},convertedToEnquiryId:{type:String},notes:[{text:{type:String},addedAt:{type:Date,default:Date.now},addedBy:{type:String}}]},{timestamps:!0,collection:"leads"});i.index({createdAt:-1,status:1});let o=a().models.CateringLead||a().model("CateringLead",i)},30070:(e,t,r)=>{r.d(t,{k:()=>o});var n=r(11185),a=r.n(n);let i=new(a()).Schema({id:{type:String,required:!0,unique:!0},type:{type:String,required:!0},recipient:{type:String,required:!0},recipientEmail:{type:String,required:!0},subject:{type:String,required:!0},status:{type:String,enum:["sent","failed","pending"],default:"pending"},messageId:String,leadId:String,bookingId:String,leadType:{type:String,enum:["event","catering","hire"]},error:String,sentAt:{type:Date,default:Date.now},metadata:a().Schema.Types.Mixed},{timestamps:!0});i.index({leadId:1}),i.index({bookingId:1}),i.index({sentAt:-1}),i.index({recipientEmail:1});let o=a().models.EmailLog||a().model("EmailLog",i)}};var t=require("../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),n=t.X(0,[8948,5972,5245,6268],()=>r(60265));module.exports=n})();